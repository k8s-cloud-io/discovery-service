CXX=g++
CFLAGS:=-O3 -Wall -Wextra -std=c++17 -pedantic
CPPFLAGS=-I./src/include \
	$(shell pkg-config --cflags libcurl) \
	$(shell pkg-config --cflags libxml-2.0) \
	$(shell pkg-config --cflags sqlite3)

LDLIBS=$(shell pkg-config --libs libcurl) \
	$(shell pkg-config --libs libxml-2.0) \
	$(shell pkg-config --libs sqlite3)

PROG:=discovery-service
OBJDIR=./.obj
BINDIR:=./bin
SRCDIR:=./src
SRCS:=$(shell find . -name "*.cpp")
OBJS:=$(patsubst $(SRCDIR)/%.cpp, $(OBJDIR)/%.o, $(SRCS))

all: $(OBJDIR) $(BINDIR) $(PROG)

$(OBJDIR):
	mkdir -p $(OBJDIR)

$(BINDIR):
	mkdir -p $(BINDIR)

$(OBJDIR)/%.o: $(SRCDIR)/%.cpp
	$(CXX) $(CFLAGS) $(CPPFLAGS) -c -o $@ $<

$(PROG): $(OBJS)
	$(CXX) $(CFLAGS) $(CPPFLAGS) -o $(BINDIR)/$(PROG) $(OBJS) $(LDLIBS)

.PHONY : clean
clean:
	rm -rf $(OBJS) data $(BINDIR)/$(PROG) $(OBJDIR) $(BINDIR)
